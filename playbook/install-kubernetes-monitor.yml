- name: create nas dir for monitoring
  hosts: nas
  gather_facts: false
  tasks:
    - name: create nas dir
      file:
        path: "{{ monitor_nfs_path }}"
        state: directory

- name: install k8s monitor
  hosts: k8s-master-init
  gather_facts: false
  vars:
    image_repository: 192.168.160.47:8888
    k8s_keepalived_vip: 192.168.160.78
    nfs_root_dir: '/data01'
    nfs_server: "{{ groups['nas'][0] }}"
    monitor_nfs_path: '{{ nfs_root_dir }}/monitoring'
    monitor_manifest_root_dir: '{{ component_manifest_dir }}/monitoring'
    prometheus_storage: '50Gi'
    prometheus_data_retention: '35d'
    grafana_storage: '50Gi'
    alertmanager_storage: '20Gi'
    alertmanager_data_retention: '120h'
  roles:
    - k8s-install-monitor