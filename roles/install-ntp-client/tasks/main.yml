- name: timedatectl set-timezone Asia/Shanghai
  shell: timedatectl set-timezone Asia/Shanghai

- name: date
  shell: date
  register: date_value

- name: show date
  debug:
    msg: "{{ date_value.stdout }}"

- name: yum install ntp -y
  shell: yum install ntp -y

- name: systemctl enable ntpd
  shell: systemctl enable ntpd

- name: /etc/ntp.conf
  template:
    src: ntp.conf.j2
    dest: /etc/ntp.conf

- name: /etc/sysconfig/ntpd
  template:
    src: ntpd.j2
    dest: /etc/sysconfig/ntpd

- name: service ntpd start/stop/restart
  shell: service ntpd stop

- name: ntpdate  ntp-server
  shell: ntpdate  {{ ntp_server }}

- name: service ntpd start & enable
  systemd:
    name: ntpd
    state: restarted
    enabled: yes

- name: add auto start ntp when bootstrap
  lineinfile:
    line: "/usr/sbin/ntpdate {{ ntp_server }} && /usr/sbin/hwclock -w && /usr/sbin/service ntpd start"
    path: /etc/rc.d/rc.local
    state: present
    mode: 0774

- name: crontab ntp -d -u
  cron:
    name: "ntpdate"
    special_time: "hourly"
    job: "/usr/sbin/service ntpd stop && /usr/sbin/ntpdate {{ ntp_server }} && /usr/sbin/hwclock -w && /usr/sbin/service ntpd start"

