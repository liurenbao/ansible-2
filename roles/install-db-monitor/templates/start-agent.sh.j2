#!/bin/bash

JAVA_HOME={{ gaussdb_jdk_dir }}
WORK_DIR={{ gaussdb_monitor_agent_root_dir }}/{{ gaussdb_user }}
SPRING_CONFIG_PATH=$WORK_DIR/application.yml
JAR_PATH=$WORK_DIR/agent.jar

startup() {
  PID=$(ps -ef | grep $JAR_PATH | awk '{print $2}')
  if [! -z $PID ]; then
      echo "Agent already started"
      exit 0
  fi
  nohup java -jar -Dspring.config.location=$SPRING_CONFIG_PATH $JAR_PATH > /dev/null  &
  echo "Agent started"
}

stop() {
  PID=$(ps -ef | grep $JAR_PATH | awk '{print $2}')
  if [ -z $PID ]; then
      kill -9 $PID
      echo "Agent stopped"
  else
      echo "Agent not running"
  fi
}

restart() {
  stop
  startup
}