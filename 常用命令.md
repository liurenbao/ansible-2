# 性能测试

```shell
sudo  route delete -net 192.168.0/16 && sudo route add -net 192.168.160.48 -netmask 255.255.0.0 192.168.85.1
sudo  route delete -net default  && sudo route add -net 10.12.0.0 -netmask 255.255.0.0 10.13.254.1

alias km="kubectl -n monitoring"
alias ke="kubectl -n elk"
alias ks="kubectl -n kube-system"
alias kd="kubectl -n kubernetes-dashboard"
alias kt="kubectl -n traefik"
alias k="kubectl" 
```
### 内置函数
```html
内置函数
为了方便查询，Prometheus 内置了一些函数来辅助计算，下面介绍一些典型的。

instant-vector abs(instant-vector)：绝对值
instant-vector sqrt(instant-vector))：平方根
instant-vector exp(instant-vector )：指数计算
instant-vector ln(instant-vector )：自然对数
instant-vector ceil(instant-vector )：向上取整
instant-vector floor(instant-vector )：向下取整
instant-vector round(instant-vector )：四舍五入取整
instant-vector delta(range-vector)：计算区间向量里最大最小的差值
instant-vector increase(range-vector)：计算区间向量里最后一个值和第一个值的差值
instant-vector rate(range-vector)：计算区间向量里的平均增长率

```

### Gauge
> 常用于表示CPU使用率、内存使用率、线程数等实时指标
1. 利用过去30分钟的数据预测1小时后的数据,预测磁盘、cpu
   predict_linear(disk_used_bytes[30m], 3600)

### counter
> 只增不减的计数器 ,Counter类型的指标其工作方式和计数器一样，只增不减（除非系统发生重置）。常见的监控指标，如http_requests_total，node_cpu都是Counter类型的监控指标。
1. 计算最近2m的请求量```app_requests_method_count_total  - (app_requests_method_count_total offset 2m)```
2. 通过rate()函数获取HTTP请求量的增长率 ```rate(http_requests_total[5m])```
3. 查询当前系统中，访问量前10的HTTP地址 ```topk(10, http_requests_total)```

### Histogram和Summary：数据分布

kubectl get secret -A | grep admin-token | awk '{system("kubectl -n " $1 " delete secret " $2) }'
kubectl -n ams get svc | awk '{system("kubectl -n ams annotate service "  $1 " maintainer=\"xuyuanwang@cicem.fa\" --overwrite")}'